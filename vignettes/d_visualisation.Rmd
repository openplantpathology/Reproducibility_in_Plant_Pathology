---
title: "Data Visualisation"
author: "Adam H. Sparks"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Data Visualisation}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
  %\VignetteDepends{janitor}
  %\VignetteDepends{tidyverse}
  %\VignetteDepends{pander}
  %\VignetteDepends{janitor}
  %\VignetteDepends{pander}
  %\VignetteDepends{ggplot2}
  %\VignetteDepends{tidyverse}
  %\VignetteDepends{sessioninfo}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
knitr::opts_chunk$set(fig.width = 6.4, fig.height = 6.4)
```

This vignette documents a simple visualisation and tabulation of the data gathered from surveying 21 journals and 450 articles in the field of plant pathology for their openness and reproducibility.

# Set-up Workspace

Load libraries used and setting the *ggplot2* theme for the document.

```{r load-libraries}
library("tidyverse")
library("janitor")
library("pander")
library("Reproducibility.in.Plant.Pathology")
theme_set(theme_classic())
```

## Import the data and calculate the reproducibility score

```{r}
rrpp <- import_notes()
```

### Individual Rating Scores

```{r evaluator-ratings}
rrpp_long <-
  pivot_longer(rrpp,
               cols = c(
                 "comp_mthds_avail",
                 "software_avail",
                 "software_cite",
                 "data_avail"
               ))

ggplot(rrpp_long, aes(x = as.factor(value))) +
  geom_bar() +
  ylab("Count") +
  xlab("Criteria Score") +
  ggtitle("Criteria scores by evaluator") +
  facet_grid(name ~ assignee)
```

# Visualise evaluations

## Computational methods available

Were the computational methods, scripts, source code, *etc.*, made available?

```{r comp_methods}
ggplot(rrpp, aes(y = as.factor(comp_mthds_avail))) +
  geom_bar() +
  ggtitle("Computational Methods Availability") +
  ylab("Score") +
  labs(caption = "NA means that no computational methods were used to generate the data,\ne.g. only PCR results reported with no statistical analysis")
```

## Software availability

Were the software used readily available and preferably open-source?

```{r software_avail}
ggplot(rrpp, aes(y = as.factor(software_avail))) +
  geom_bar() +
  ggtitle("Software Availability") +
  ylab("Score")
```

## Software citations

Were the software that was used properly cited?

```{r software_cite}
ggplot(rrpp, aes(y = as.factor(software_cite))) +
  geom_bar() +
  ggtitle("Software Cited") +
  ylab("Score")
```

## Software used (cited)

Count and sort top 10 software packages cited.
There are likely others that are used, but they have not been properly cited or listed by the authors.

First create a tidy data frame of the data by unnesting software used as in many cases multiple software packages were used, so will end up with multiple rows for same article, one for each software.

```{r software_used}
rrpp_software <-
  rrpp %>%
  transform(software_used = strsplit(software_used, ",")) %>%
  unnest(software_used) %>%
  mutate(software_used = trimws(software_used)) %>%
  mutate(software_used = toupper(software_used)) # convert all to uppercase to standardise
```

Now graph the top ten software packages used.

```{r top_10}
tab <- table(rrpp_software$software_used)
tab_s <- as.data.frame(sort(tab))
tab_s <-
  tab_s %>%
  arrange(desc(Freq)) %>%
  filter(Freq %in% head(unique(Freq), 10)) %>% 
  rename("Software" = "Var1", "Frequency" = "Freq")

ggplot(tab_s, aes(y = Software, x = Frequency)) +
  geom_bar(stat = "identity") +
  ggtitle("Top 10 Software Used") +
  xlab("Count") +
  ylab("Software")
```

## Data availability

Were the data made readily available?

```{r data_avail1}
ggplot(rrpp, aes(y = as.factor(data_avail))) +
  geom_bar() +
  ggtitle("Data Availability") +
  ylab("Score")
```

## Journal effect on reproducibility score

```{r journal}
rrpp %>%
  pivot_longer(cols = c("comp_mthds_avail", "data_avail", "software_avail")) %>%
  ggplot(aes(x = value,
             y = abbreviation)) +
  geom_count(alpha = 0.5) +
  facet_wrap(. ~ name) +
  xlab("Score")
```

## Five year impact factor effect on reproducibility score

```{r IF, message=FALSE}
rrpp %>%
  pivot_longer(cols = c("comp_mthds_avail", "data_avail", "software_avail")) %>%
  ggplot(aes(x = value,
             y = IF_5year)) +
  geom_count(alpha = 0.5) +
  facet_wrap(. ~ name) +
  xlab("Score")
```

## Journal open access effect on reproducibility score

```{r open_access}
rrpp %>%
  pivot_longer(cols = c("comp_mthds_avail", "data_avail", "software_avail")) %>%
  ggplot(aes(x = value,
             y = as.factor(open))) +
  geom_count() +
  ggtitle("Journal Open Access Classification Effect") +
  ylab("Classification") +
  xlab("Open Access Classification")
```

## Journal reproducibility instructions effect on reproducibility score

```{r repro_inst}
rrpp %>%
  pivot_longer(cols = c("comp_mthds_avail", "data_avail", "software_avail")) %>%
  ggplot(aes(x = value,
             y = as.factor(repro_inst))) +
  geom_count(alpha = 0.5) +
  ggtitle("Reproducibility Instructions Effect") +
  ylab("Score") +
  xlab("Reproducibility Instructions Score") +
  facet_wrap(. ~ name)
```

## Scores by year

```{r full_score, message=FALSE}
rrpp %>%
  pivot_longer(cols = c("comp_mthds_avail", "data_avail", "software_avail")) %>%
  ggplot(aes(x = value,
             y = year)) +
  geom_count(alpha = 0.5) +
  ylab("Score") +
  xlab("Year") +
  facet_wrap(. ~ name)
```

# Tables

## Table of journals surveyed

```{r journals}
rrpp_journals <- tabyl(rrpp, journal)[, -3]
names(rrpp_journals) <- c("Journal", "n")
pander(rrpp_journals)
```
