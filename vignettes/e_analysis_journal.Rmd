---
title: "Analysis of Journal Effect"
author: "Adam H. Sparks"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Analysis of Journal Effect}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
  %\VignetteDepends{brms}
  %\VignetteDepends{bayestestR}
  %\VignetteDepends{bayesplot}
  %\VignetteDepends{ggplot2}
  %\VignetteDepends{here}
  %\VignetteDepends{pander}
  %\VignetteDepends{sessioninfo}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
knitr::opts_chunk$set(fig.width = 6.4, fig.height = 6.4)
```

This vignette documents the analysis of the data gathered from surveying 21 journals and 450 articles in the field of plant pathology for their openness and reproducibility and the effect that the journal it was published in had on that score.

# Set-up Workspace

Load libraries used and setting the *ggplot2* theme for the document.

```{r load-libraries, message=FALSE}
library("brms")
library("bayestestR")
library("bayesplot")
library("ggplot2")
library("here")
library("pander")
library("Reproducibility.in.Plant.Pathology")

options(mc.cores = parallel::detectCores())
theme_set(theme_classic())
```

## Import Data

```{r import-notes}
rrpp <- import_notes()
```

## Notes

All models are using the same priors.

Because of the amount of zero values in the `reproducibility_score` a `hurdle_gamma()` family is used for all models as well.

## Journal Effect Model

### Priors

The priors are fairly flat.

```{r priors}
priors <- prior_string("normal(0, 10)")
```

## Journal Effect Model

Test the effect that the journal's effect on the reproducibility score.
Set up a *brms* model with journal (`abbreviation`) as the fixed effect and `year` and `assignee` as random effects.
Base level is set to Molecular Plant Pathology, the journal with the highest five-year impact factor that will be used as the intercept in the following model.

### Model with assignee as random effect

```{r journal-evaluation-w-assignee}
# relevel factors for analysis, use Mol Plant Pathol as basis for analysis, highest IF
rrpp <-
  within(rrpp,
         abbreviation <- relevel(abbreviation, ref = "Mol Plant Pathol"))

m1 <-
  brm(
    formula = reproducibility_score ~  abbreviation + (1 | year) +
      (1 | assignee),
    data = rrpp,
    seed = 27,
    prior = priors,
    family = "hurdle_gamma",
    control = list(adapt_delta = 0.999,
                   max_treedepth = 15),
    iter = 3000,
    chains = 4
  )

summary(m1)

plot(m1)

pp_check(m1)
```

### Model with out assignee as random effect

```{r journal-evaluation-wo-assignee}
m1.1 <-
  brm(
    formula = reproducibility_score ~  abbreviation + (1 | year),
    data = rrpp,
    seed = 27,
    prior = priors,
    family = "hurdle_gamma",
    control = list(adapt_delta = 0.999,
                   max_treedepth = 15),
    iter = 3000,
    chains = 4
  )

summary(m1.1)

plot(m1.1)

pp_check(m1.1)
```

## Evaluate models' fit

```{r evaluate-fit}
m1 <- add_criterion(m1, "loo")
m1.1 <- add_criterion(m1.1, "loo")

loo_compare(m1, m1.1)
```

The model, `m1`, demonstrates the better fit, having the evaluator as a random effect, therefore we will use this model for this analysis and include the assignee as a random effect in the following analyses.

## Effect of Journal on Score

```{r journal-effect}
plot(pd(m1))

pander(equivalence_test(m1))
```

## Save model object

Save the model object, `m1` for figures in the paper.

```{r save-data}
save(m1, file = here("inst/extdata/m1.Rda"))
```

# Colophon

```{r sessioninfo}
sessioninfo::session_info()
```
