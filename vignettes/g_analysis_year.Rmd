---
title: "Analysis of Publication Year Effect"
author: "Adam H. Sparks"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Analysis of Publication Year Effect}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
  %\VignetteDepends{brms}
  %\VignetteDepends{bayestestR}
  %\VignetteDepends{bayesplot}
  %\VignetteDepends{ggplot2}
  %\VignetteDepends{here}
  %\VignetteDepends{pander}
  %\VignetteDepends{parallel}
  %\VignetteDepends{report}
  %\VignetteDepends{sessioninfo}
  %\VignetteDepends{tidyr}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
knitr::opts_chunk$set(fig.width = 6.4, fig.height = 6.4)
```

This vignette documents the analysis of the data gathered from surveying 21 journals and 450 articles in the field of plant pathology for their openness and reproducibility and the effect that the publication year had on that score.

# Set-up Workspace

Load libraries used and setting the *ggplot2* theme for the document.

```{r load-libraries, message=FALSE}
library("brms")
library("bayestestR")
library("bayesplot")
library("ggplot2")
library("here")
library("pander")
library("report")
library("tidyr")
library("Reproducibility.in.Plant.Pathology")

options(mc.cores = parallel::detectCores())
theme_set(theme_classic())
```

### Priors

Priors were set to be generic weakly informative.

```{r priors}
priors <- c(prior(normal(0, 1), class = "b"),
            prior(normal(0, 1), class = "Intercept"))
```

## Year of Publication Effect Models

### Computational Methods Availability

Test the effect that year of publication had on the code availability and detect differences over time.
Here, `year` is a fixed effect, `journal` and `assignee` are assigned as random effects.

```{r code}
rrpp <- import_notes()
rrpp <- drop_na(rrpp, comp_mthds_avail)

m_g1 <-
  brm(
    formula = comp_mthds_avail ~ year +
      (1 | abbreviation) +
      (1 | assignee),
    data = rrpp,
    seed = 27,
    prior = priors,
    family = cumulative(link = "logit"),
    iter = 10000,
    control = list(adapt_delta = 0.9999),
  )

summary(m_g1)

plot(m_g1)

pp_check(m_g1, ndraws = 50, type = "bars")

plot(equivalence_test(m_g1))

pander(m_g1_report <- report(m_g1))

m_g1_es <- report_effectsize(m_g1)
```

### Data Availability

```{r data}
rrpp <- import_notes()
rrpp <- drop_na(rrpp, data_avail)

m_g2 <-
  brm(
    formula = data_avail ~ year +
      (1 | abbreviation) +
      (1 | assignee),
    data = rrpp,
    seed = 27,
    prior = priors,
    family = cumulative(link = "logit"),
    iter = 10000,
    control = list(adapt_delta = 0.99999),
  )

summary(m_g2)

plot(m_g2)

pp_check(m_g2, ndraws = 50, type = "bars")

plot(equivalence_test(m_g2))

pander(m_g2_report <- report(m_g2))

m_g2_es <- report_effectsize(m_g2)
```

## Save Model Objects

Save the model objects for figures in the paper.

```{r save-models}
save(m_g1, file = here("inst/extdata/m_g1.Rda"))
save(m_g2, file = here("inst/extdata/m_g2.Rda"))

save(m_g1_report, file = here("inst/extdata/m_g1_report.Rda"))
save(m_g2_report, file = here("inst/extdata/m_g2_report.Rda"))

save(m_g1_es, file = here("inst/extdata/m_g1_es.Rda"))
save(m_g2_es, file = here("inst/extdata/m_g2_es.Rda"))
```

# Colophon

```{r sessioninfo}
sessioninfo::session_info()
```
