---
title: "Analysis of Journal Effect"
author: "Adam H. Sparks"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Analysis of Journal Effect}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
  %\VignetteDepends{brms}
  %\VignetteDepends{bayestestR}
  %\VignetteDepends{bayesplot}
  %\VignetteDepends{ggplot2}
  %\VignetteDepends{here}
  %\VignetteDepends{sessioninfo}
  %\VignetteDepends{tidyr}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
knitr::opts_chunk$set(fig.width = 6.4, fig.height = 6.4)
```

This vignette documents the analysis of the data gathered from surveying 21 journals and 450 articles in the field of plant pathology for their openness and reproducibility and the effect that the journal it was published in had on that score.

# Set-up Workspace

Load libraries used and setting the *ggplot2* theme for the document.

```{r load-libraries, message=FALSE}
library("brms")
library("bayestestR")
library("bayesplot")
library("ggplot2")
library("here")
library("tidyr")
library("Reproducibility.in.Plant.Pathology")

options(mc.cores = parallel::detectCores())
theme_set(theme_classic())
```

## Notes

All models are using the same priors.

## Journal Effect Models

### Priors

```{r priors}
priors <-  prior_string("normal(0, 1.5)")
```

### Computational Methods Availability

Test the effect that the journal's effect on the available of computational methods.
Set up a *brms* model with journal (`abbreviation`) as the fixed effect and `year` and `assignee` as random effects.
Base level is set to *Molecular Plant Pathology*, the journal with the highest five-year impact factor that will be used as the intercept in the following model.

```{r code}
# import data
rrpp <- import_notes()

# relevel factors for analysis, use Mol Plant Pathol as basis for analysis, highest IF
rrpp <-
  within(rrpp,
         abbreviation <- relevel(abbreviation, ref = "Mol Plant Pathol"))

rrpp <- drop_na(rrpp, comp_mthds_avail)

m_f1 <-
  brm(
    formula = comp_mthds_avail ~ abbreviation +
      (1 | assignee) +
      (1 | year),
    data = rrpp,
    seed = 27,
    prior = priors,
    family = cumulative(link = "logit"),
    iter = 6000,
    control = list(adapt_delta = 0.999)
  )

summary(m_f1)

plot(m_f1)

pp_check(m_f1)

plot(pd(m_f1))

equivalence_test(m_f1)
```

### Data Availability

Test the effect that the journal may have on the availability of data.
Base level is set to *Molecular Plant Pathology*, the journal with the highest five-year impact factor that will be used as the intercept in the following model.

```{r data}
# reimport data due to changes in previous model dropping NA values
rrpp <- import_notes()
rrpp <-
  within(rrpp,
         abbreviation <- relevel(abbreviation, ref = "Mol Plant Pathol"))

rrpp <- drop_na(rrpp, data_avail)

m_f2 <-
  brm(
    formula = data_avail ~ abbreviation +
      (1 | assignee) +
      (1 | year),
    data = rrpp,
    seed = 27,
    prior = priors,
    family = cumulative(link = "logit"),
    iter = 6000,
    control = list(adapt_delta = 0.999)
  )

summary(m_f2)

plot(m_f2)

pp_check(m_f2)

plot(pd(m_f2))

equivalence_test(m_f2)
```

### Openness

Test for any effects of the journal on the `software_avail` (openness) of the software used.
Test the effect that the journal may have on the availability of data.

```{r openness}
rrpp <- import_notes()
rrpp <-
  within(rrpp,
         abbreviation <- relevel(abbreviation, ref = "Mol Plant Pathol"))
rrpp <- drop_na(rrpp, software_avail)

m_f3 <-
  brm(
    formula = software_avail ~  abbreviation +
      (1 | assignee) +
      (1 | year),
    data = rrpp,
    seed = 27,
    prior = priors,
    family = cumulative(link = "logit"),
    iter = 6000,
    control = list(adapt_delta = 0.999)
  )

summary(m_f3)

plot(m_f3)

pp_check(m_f3)

plot(pd(m_f3))

equivalence_test(m_f3)
```

## Save Model Objects

Save the model objects for figures in the paper.

```{r save-data}
save(m_f1, file = here("inst/extdata/m_f1.Rda"))
save(m_f2, file = here("inst/extdata/m_f2.Rda"))
save(m_f3, file = here("inst/extdata/m_f3.Rda"))
```

# Colophon

```{r sessioninfo}
sessioninfo::session_info()
```
