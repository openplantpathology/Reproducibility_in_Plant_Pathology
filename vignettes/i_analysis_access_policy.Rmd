---
title: "Analysis of Open Access Policy Effect"
author: "Adam H. Sparks"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Analysis of Open Access Policy Effect}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
  %\VignetteDepends{brms}
  %\VignetteDepends{bayestestR}
  %\VignetteDepends{bayesplot}
  %\VignetteDepends{ggplot2}
  %\VignetteDepends{here}
  %\VignetteDepends{pander}
  %\VignetteDepends{report}
  %\VignetteDepends{sessioninfo}
  %\VignetteDepends{tidyr}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
knitr::opts_chunk$set(fig.width = 6.4, fig.height = 6.4)
```

This vignette documents the analysis of the data gathered from surveying 21 journals and 450 articles in the field of plant pathology for their openness and reproducibility and the effect that the journal's access policy had on that score.

# Set-up Workspace

Load libraries used and setting the *ggplot2* theme for the document.

```{r load-libraries, message=FALSE}
library("brms")
library("bayestestR")
library("bayesplot")
library("ggplot2")
library("here")
library("pander")
library("report")
library("tidyr")
library("Reproducibility.in.Plant.Pathology")

options(mc.cores = parallel::detectCores())
theme_set(theme_classic())
```

## Journal Open Access Policy Model

### Computational Methods Availability

Test the effect that journal's open access policy had on the reproducibility score.
Here, `open` is a fixed effect, `year`, `journal` and `assignee` are assigned as random effects.

```{r code}
rrpp <- import_notes()
rrpp <- drop_na(rrpp, comp_mthds_avail)

priors <- c(prior(normal(0, 1), class = "b"),
            prior(normal(0, 1), class = "Intercept"))

m_i1 <-
  brm(
    formula = comp_mthds_avail ~ open +
      (1 | abbreviation) +
      (1 | assignee) +
      (1 | year),
    data = rrpp,
    seed = 27,
    prior = priors,
    family = cumulative(link = "probit"),
    control = list(adapt_delta = 0.999),
    iter = 10000
  )

summary(m_i1)

plot(m_i1)

pp_check(m_i1, type = "bars", draws = 50)

plot(equivalence_test(m_i1))

pander(m_i1_report <- report(m_i1))
```

### Data Availability

Test for any effects of the journals' open access policy on the data's availability.

```{r data}
rrpp <- import_notes()
rrpp <- drop_na(rrpp, data_avail)

m_i2 <-
  brm(
    formula = data_avail ~ open + 
      (1 | abbreviation) +
      (1 | assignee) +
      (1 | year),
    data = rrpp,
    seed = 27,
    prior = priors,
    family = cumulative(link = "probit"),
    control = list(adapt_delta = 0.99),
    iter = 10000
  )

summary(m_i2)

plot(m_i2)

pp_check(m_i2, type = "bars", draws = 50)

plot(equivalence_test(m_i2))

pander(m_i2_report <- report(m_i2))
```

## Save Model Objects

Save the model for figures in the paper.

```{r save-models}
# save the model for figures in the paper
save(m_i1, file = here("inst/extdata/m_i1.Rda"))
save(m_i2, file = here("inst/extdata/m_i2.Rda"))

save(m_i1_report, file = here("inst/extdata/m_i1_report.Rda"))
save(m_i2_report, file = here("inst/extdata/m_i2_report.Rda"))
```

# Colophon

```{r sessioninfo}
sessioninfo::session_info()
```
