---
title: "Analysis of Software Used Effect"
author: "Adam H. Sparks"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Analysis of Software Used Effect}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
  %\VignetteDepends{brms}
  %\VignetteDepends{bayestestR}
  %\VignetteDepends{bayesplot}
  %\VignetteDepends{dplyr}
  %\VignetteDepends{ggplot2}
  %\VignetteDepends{here}
  %\VignetteDepends{sessioninfo}
  %\VignetteDepends{tidyr}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
knitr::opts_chunk$set(fig.width = 6.4, fig.height = 6.4)
```

This vignette documents the analysis of the data gathered from surveying 21 journals and 450 articles in the field of plant pathology for their openness and reproducibility and the effect that the journal's access policy had on that score.

# Set-up Workspace

Load libraries used and setting the *ggplot2* theme for the document.

```{r load-libraries, message=FALSE}
library("brms")
library("bayestestR")
library("bayesplot")
library("dplyr")
library("ggplot2")
library("here")
library("tidyr")
library("Reproducibility.in.Plant.Pathology")

options(mc.cores = parallel::detectCores())
theme_set(theme_classic())
```

## Journal Software Used Model

### Computational Methods Availability

Test the effect that the software used had on the availability of the code.
Here, `open` is a fixed effect, `year`, `journal` and `assignee` are assigned as random effects.

```{r code}
rrpp <- import_notes() %>%
  transform(software_used = strsplit(software_used, ",")) %>%
  unnest(software_used) %>%
  mutate(software_used = trimws(software_used)) %>%
  mutate(software_used = toupper(software_used)) %>% 
  mutate(software_used = as.factor(software_used)) %>% 
  drop_na(comp_mthds_avail)

priors <-  prior_string("normal(0, 1.5)")

m_j1 <-
  brm(
    formula = comp_mthds_avail ~ software_used +
      (1 | abbreviation) +
      (1 | assignee),
    data = rrpp,
    seed = 27,
    prior = priors,
    family = cumulative(link = "logit"),
    control = list(adapt_delta = 0.999),
    iter = 6000
  )

summary(m_j1)

plot(m_j1)

pp_check(m_j1)

equivalence_test(m_j1)
```

### Data Availability

Test for any effects of the five year impact factor on the data's availability.

```{r data}
rrpp <- import_notes() %>%
  transform(software_used = strsplit(software_used, ",")) %>%
  unnest(software_used) %>%
  mutate(software_used = trimws(software_used)) %>%
  mutate(software_used = toupper(software_used)) %>%
  drop_na(data_avail)

m_j2 <-
  brm(
    formula = data_avail ~ software_used + 
      (1 | abbreviation) +
      (1 | assignee),
    data = rrpp,
    seed = 27,
    prior = priors,
    family = cumulative(link = "logit"),
    control = list(adapt_delta = 0.99),
    iter = 6000
  )

summary(m_j2)

plot(m_j2)

pp_check(m_j2)

equivalence_test(m_j2)
```

## Save Model Objects

Save the model for figures in the paper.

```{r save-models}
# save the model for figures in the paper
save(m_j1, file = here("inst/extdata/m_j1.Rda"))
save(m_j2, file = here("inst/extdata/m_j2.Rda"))
```

# Colophon

```{r sessioninfo}
sessioninfo::session_info()
```
